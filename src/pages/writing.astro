---
import { getCollection } from 'astro:content';
import SiteShell from '../layouts/SiteShell.astro';
import PageHeader from '../components/layout/PageHeader.astro';
import Container from '../components/ui/Container.astro';
import Section from '../components/ui/Section.astro';
import Grid from '../components/ui/Grid.astro';
import Tag from '../components/ui/Tag.astro';
import WritingCard from '../components/writing/WritingCard.astro';
import { shellConfig } from '../data/site';

const writing = (await getCollection('writing'))
  .map(({ data }) => data)
  .sort(
    (left, right) =>
      left.sortOrder - right.sortOrder || left.title.localeCompare(right.title),
  );

const caseStudies = writing.filter((entry) => entry.kind === 'case-study');
const methods = writing.filter((entry) => entry.kind === 'method');
---

<SiteShell
  {...shellConfig}
  title="Writing | Jignasu Pathak"
  description="Content-driven writing index with separate case study and method groupings."
>
  <PageHeader
    eyebrow="Thinking"
    title="Writing"
    description="Writing remains grouped by meaning rather than becoming one undifferentiated stream, and every entry now comes from structured content."
  >
    <Tag slot="meta" tone="accent">{caseStudies.length} case studies</Tag>
    <Tag slot="meta">{methods.length} methods</Tag>
  </PageHeader>

  <Section size="sm">
    <Container size="wide">
      <Grid cols="2" gap="lg">
        <section class="writing-group" aria-labelledby="case-studies-title">
          <div class="writing-group__head">
            <h2 id="case-studies-title">Case Studies</h2>
            <p>Project-linked narratives that capture decisions, tradeoffs, and lessons learned.</p>
          </div>
          <div class="writing-group__list">
            {caseStudies.length > 0 ? (
              caseStudies.map((entry) => <WritingCard {...entry} />)
            ) : (
              <p class="writing-group__empty">Case studies will appear here as entries are added.</p>
            )}
          </div>
        </section>

        <section
          class="writing-group writing-group--soft"
          aria-labelledby="methods-title"
        >
          <div class="writing-group__head">
            <h2 id="methods-title">Methods</h2>
            <p>Reusable engineering patterns that apply across projects and experiments.</p>
          </div>
          <div class="writing-group__list">
            {methods.length > 0 ? (
              methods.map((entry) => <WritingCard {...entry} />)
            ) : (
              <p class="writing-group__empty">Methods will appear here as entries are added.</p>
            )}
          </div>
        </section>
      </Grid>
    </Container>
  </Section>
</SiteShell>

<style>
  .writing-group {
    display: grid;
    gap: var(--space-5);
    padding: var(--card-padding);
    border: var(--border-thin);
    border-radius: var(--radius-lg);
    background:
      linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(255, 249, 251, 0.95));
    box-shadow: var(--shadow-soft);
  }

  .writing-group--soft {
    background:
      linear-gradient(180deg, rgba(249, 238, 244, 0.86), rgba(255, 249, 251, 0.95));
  }

  .writing-group__head,
  .writing-group__list {
    display: grid;
    gap: var(--space-4);
  }

  .writing-group__head p,
  .writing-group__empty {
    margin: 0;
    color: var(--color-text-secondary);
    line-height: var(--line-relaxed);
  }

  .writing-group__head h2 {
    margin: 0;
  }
</style>
